<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Installing PAM support</title><meta name="generator" content="DocBook XSL Stylesheets V1.60.1"><link rel="home" href="index.html" title="External Authentication"><link rel="up" href="ext-auth-install.html" title="Installation"><link rel="previous" href="ext-auth-install.html" title="Installation"><link rel="next" href="ext-auth-ldap-install.html" title="Installing LDAP support"><link rel="stylesheet" href="openacs.css" type="text/css"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><a href="http://openacs.org"><img src="/doc/images/alex.jpg" border="0"></a><table width="100%" summary="Navigation header" border="0"><tr><td width="20%" align="left"><a accesskey="p" href="ext-auth-install.html">Prev</a> </td><th width="60%" align="center">Installation</th><td width="20%" align="right"> <a accesskey="n" href="ext-auth-ldap-install.html">Next</a></td></tr></table><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ext-auth-pam-install"></a>Installing PAM support</h2></div></div><div></div></div><p>OpenACS supports PAM authetication via the ns_pam module in AOLserver.</p><div class="orderedlist"><ol type="1"><li><p><b>Add PAM support to AOLserver. </b>OpenACS supports PAM support via the PAM AOLserver
        module.  PAM is system of modular support, and can provide
        local (unix password), RADIUS, LDAP (<a href="http://www.tldp.org/HOWTO/LDAP-Implementation-HOWTO/pamnss.html" target="_top">more
        information</a>), and other forms of
        authentication.  Note that due to security issues, the
        AOLserver PAM module cannot be used for local password
        authentication.  </p><div class="orderedlist"><ol type="a"><li><p><a name="install-nspam"></a><b>Compile and install ns_pam. </b>Download the <a href="/doc/nspam-download" target="_top">tarball</a> to
            <tt class="computeroutput">/tmp</tt>.</p><p>Debian users: first do <b class="userinput"><tt>apt-get install libpam-dev</tt></b></p><pre class="screen">[root@yourserver root]# <b class="userinput"><tt>cd /usr/local/src/aolserver</tt></b>
[root@yourserver aolserver]# <b class="userinput"><tt>tar xzf /tmp/ns_pam-0.1.tar.gz</tt></b>
[root@yourserver aolserver]# <b class="userinput"><tt>cd nspam</tt></b>
[root@yourserver nspam]# <b class="userinput"><tt>make</tt></b>
gcc -I/usr/include/pam -I/usr/local/aolserver/include -D_REENTRANT=1 
  -DNDEBUG=1 -g -fPIC -Wall -Wno-unused -mcpu=i686 -DHAVE_CMMSG=1 
  -DUSE_FIONREAD=1 -DHAVE_COND_EINTR=1   -c -o nspam.o nspam.c
nspam.c: In function `PamCmd':
nspam.c:107: warning: implicit declaration of function `Tcl_SetObjResult'
nspam.c:107: warning: implicit declaration of function `Tcl_NewIntObj'
gcc -I/usr/include/pam -I/usr/local/aolserver/include -D_REENTRANT=1 
  -DNDEBUG=1 -g -fPIC -Wall -Wno-unused -mcpu=i686 -DHAVE_CMMSG=1 
  -DUSE_FIONREAD=1 -DHAVE_COND_EINTR=1   -c -o pam_support.o pam_support.c
/bin/rm -f nspam.so
gcc -shared -nostartfiles -o nspam.so nspam.o pam_support.o -lpam
[root@yourserver nspam]# <b class="userinput"><tt>cp nspam.o /usr/local/aolserver/bin</tt></b>
[root@yourserver nspam]#
<pre class="action"><span class="action">cd /usr/local/src/aolserver
tar xzf /tmp/ns_pam-0.1.tar.gz
cd nspam
make
cp nspam.so /usr/local/aolserver/bin</span></pre></pre></li><li><p><b>Set up a PAM domain. </b>A PAM domain is a set of rules for granting
            privileges based on other programs.  Each instance of
              AOLserver uses a domain; different aolserver instances
              can use the same domain but one AOLserver instance
              cannot use two domains.  The domain describes
              which intermediate programs will be used to check
              permissions.  You may need to install software to
              perform new types of authentication.
</p><div class="itemizedlist"><ul type="disc"><li><p><b>RADIUS in PAM. </b></p><div class="orderedlist"><ol type="i"><li><p>Untar the <a href="/doc/individual-programs.html#pam-radius-download" target="_top">pam_radius
                    tarball</a> and compile and install.  (<a href="http://www.freeradius.org/pam_radius_auth/" target="_top">more
                    information</a>)</p><pre class="screen">[root@yourserver root]# <b class="userinput"><tt>cd /usr/local/src/</tt></b>
[root@yourserver src]# <b class="userinput"><tt>tar xf /tmp/pam_radius-1.3.16.tar</tt></b>
[root@yourserver src]# <b class="userinput"><tt>cd pam_radius-1.3.16</tt></b>
[root@yourserver pam_radius-1.3.16]# <b class="userinput"><tt>make</tt></b>
cc -Wall -fPIC -c pam_radius_auth.c -o pam_radius_auth.o
cc -Wall -fPIC   -c -o md5.o md5.c
ld -Bshareable pam_radius_auth.o md5.o -lpam -o pam_radius_auth.so
[root@yourserver pam_radius-1.3.16]# <b class="userinput"><tt>cp pam_radius_auth.so /lib/security/pam_radius_auth.so</tt></b>
[root@yourserver pam_radius-1.3.16]#
<pre class="action"><span class="action">cd /usr/local/src/
tar xf /tmp/pam_radius-1.3.16.tar
cd pam_radius-1.3.16
make
cp pam_radius_auth.so /lib/security/pam_radius_auth.so</span></pre></pre><p>Debian users: <b class="userinput"><tt>apt-get install libpam-radius-auth</tt></b></p></li><li><p>Set up the PAM domain by creating the file
                <tt class="computeroutput">/etc/pam.d/<span class="replaceable"><span class="replaceable">service0</span></span></tt>
                with these contents:</p><pre class="programlisting">auth       sufficient   /lib/security/pam_radius_auth.so
</pre></li><li><p>Modify the AOLserver configuration file to use
                this PAM domain.  Edit the line</p><pre class="programlisting">ns_param   PamDomain             "<span class="replaceable"><span class="replaceable">service0</span></span>"</pre><p>So that the value of the parameter matches the name (just the file name, not the fully pathed name) of the domain file in </p><pre class="programlisting">/etc/pam.d/</pre></li></ol></div></li><li><p><b>LDAP in PAM. </b><a href="http://www.tldp.org/HOWTO/LDAP-Implementation-HOWTO/pamnss.html#AEN110" target="_top">more information</a></p></li></ul></div></li><li><p><b>Modify the AOLserver configuration file to support ns_pam. </b></p><p>In
          <tt class="computeroutput">/var/lib/aolserver/<span class="replaceable"><span class="replaceable">service0</span></span>/etc/config.tcl</tt>, enable the nspam module by uncommenting this line:</p><pre class="programlisting">ns_param   nspam           ${bindir}/nspam.so</pre></li></ol></div></li><li><p><b>Install auth-pam OpenACS service package. </b><a href="/acs-admin/install/" target="_top">Install</a> <tt class="computeroutput">auth-pam</tt> and restart the server.</p></li><li><p><a name="ext-auth-create-authority"></a><b>Create an OpenACS authority. </b>OpenACS supports multiple authentication authorities.
        The OpenACS server itself is the "Local Authority," used by
        default.</p><div class="orderedlist"><ol type="a"><li><p>Browse to the authentication administration page,
            <tt class="computeroutput">http://<span class="replaceable"><span class="replaceable">yourserver</span></span><a href="/acs-admin/auth/" target="_top">/acs-admin/auth/</a></tt>.
             Create and name an authority (in the sitewide admin UI)</p></li><li><p>Set Authentication to PAM.</p></li><li><p>If the PAM module contains a <tt class="computeroutput">password</tt> command, you can set Password Management to PAM.  If not, the PAM module cannot change the user's password and you should leave this option Disabled.</p></li><li><p>Leave Account Registration disabed.</p></li><li><p>Set Batch sync enabled to Yes.  Set GetDocumentImplementation to HTTP GET.  Set ProcessDocumentImplementation to IMS Enterprise 1.1.  These settings will cause OpenACS to attempt to retrieve via HTTP a list of users in XML format from a location we will specify in a few steps.</p></li><li><p>Click OK.</p></li><li><p>On the next page, click <tt class="computeroutput">Configure</tt> on the GetDocument Implementation line.</p></li><li><p>Enter the IncrementalURL and SnapshotURL.  These are the URLs which the external Authority will supply with XML files in IMS Enterprise 1.1 format.</p></li><li><p>Configure your Authority (RADIUS server, etc) to supply XML files to the URLs IncrementalURL and SnapshotURL</p><pre class="programlisting">
&lt;enterprise&gt;
  &lt;person recstatus = "1"&gt;  <span class="emphasis"><em>added person</em></span>
    &lt;sourcedid&gt;
      &lt;id&gt;[username]&lt;/id&gt;
    &lt;/sourcedid&gt;
    &lt;name&gt;
      &lt;family&gt;[last_name]&lt;/family&gt;
      &lt;given&gt;[first_names]&lt;/given&gt;
    &lt;/name&gt;
    &lt;email&gt;[email]&lt;/email&gt;
    &lt;url&gt;[homepage_url]&lt;/url&gt;
  &lt;/person&gt;
  &lt;person recstatus = "2"&gt;    <span class="emphasis"><em>modified person</em></span>
    ...
  &lt;/person&gt;
  &lt;person recstatus = "3"&gt;    <span class="emphasis"><em>deleted person</em></span>
    &lt;sourcedid&gt;
      &lt;id&gt;LL1&lt;/id&gt;      <span class="emphasis"><em>only requires username</em></span>
    &lt;/sourcedid&gt;
  &lt;/person&gt;
&lt;/enterprise&gt;</pre><p>(More information: <a href="ims-sync-driver-design.html" title="IMS Sync driver design">Section , &#8220;IMS Sync driver design&#8221;</a>, <a href="http://www.imsproject.org/enterprise/" target="_top">The IMS 1.1 spec</a>)</p></li></ol></div></li></ol></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ext-auth-install.html">Prev</a> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right"> <a accesskey="n" href="ext-auth-ldap-install.html">Next</a></td></tr><tr><td width="40%" align="left">Installation </td><td width="20%" align="center"><a accesskey="u" href="ext-auth-install.html">Up</a></td><td width="40%" align="right"> Installing LDAP support</td></tr></table><hr><address><a href="mailto:docs@openacs.org">docs@openacs.org</a></address></div><a name="comments"></a><center><a href="http://openacs.org/doc/ext-auth-pam-install.html#comments">View comments on this page at openacs.org</a></center></body></html>
